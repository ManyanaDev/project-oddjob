"use strict";(()=>{var u=Object.defineProperty;var w=(r,e,t)=>e in r?u(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var c=(r,e,t)=>w(r,typeof e!="symbol"?e+"":e,t);var a=(r,e,t)=>new Promise((n,i)=>{var s=o=>{try{d(t.next(o))}catch(h){i(h)}},m=o=>{try{d(t.throw(o))}catch(h){i(h)}},d=o=>o.done?n(o.value):Promise.resolve(o.value).then(s,m);d((t=t.apply(r,e)).next())});var l=class{constructor(e={}){c(this,"endpoint");c(this,"domain");c(this,"initialized",!1);c(this,"sessionStartTime");c(this,"isTracking",!1);c(this,"handleRouteChange",this.debounce(()=>a(this,null,function*(){yield this.trackPageView()}),1e3));let t=document.querySelector('script[src*="analytics.min.js"]'),n=t==null?void 0:t.src.replace("analytics.min.js","api/events");this.endpoint=e.endpoint||n||"/api/events",this.domain=e.domain||window.location.hostname,this.sessionStartTime=Date.now(),this.init()}init(){return a(this,null,function*(){if(this.initialized)return;setTimeout(()=>this.trackPageView(),100),this.setupSessionEndTracking(),window.addEventListener("popstate",this.handleRouteChange);let e=window.location.href,t=new MutationObserver(this.debounce(()=>{let i=window.location.href;i!==e&&(e=i,this.handleRouteChange())},1e3)),n=document.querySelector("body");n&&t.observe(n,{childList:!0,subtree:!0,attributes:!1,characterData:!1}),this.initialized=!0})}debounce(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}setupSessionEndTracking(){window.addEventListener("beforeunload",()=>{this.trackSessionEnd()}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.trackSessionEnd()});let e,t=()=>{clearTimeout(e),e=setTimeout(()=>{this.trackSessionEnd()},30*60*1e3)};["mousedown","keydown","touchstart","scroll"].forEach(n=>{window.addEventListener(n,t,{passive:!0})}),t()}trackSessionEnd(){return a(this,null,function*(){try{let e=Date.now()-this.sessionStartTime,t=new URL(this.endpoint);t.searchParams.append("domain",this.domain),t.searchParams.append("event","session_end"),t.searchParams.append("duration",e.toString()),yield this.loadPixel(t.toString())}catch(e){console.warn("Failed to track session end:",e)}})}loadPixel(e){return a(this,null,function*(){return new Promise((t,n)=>{let i=new Image;i.onload=()=>{i.remove(),t()},i.onerror=s=>{i.remove(),s instanceof ErrorEvent?n(new Error(`Network error: ${s.message}`)):n(new Error("Failed to load tracking pixel"))},i.src=e,i.style.display="none",document.body.appendChild(i)})})}getUtmParams(){let e=new URLSearchParams(window.location.search),t={};return["source","medium","campaign","term","content"].forEach(n=>{let i=e.get(`utm_${n}`);i&&(t[n]=i)}),t}trackPageView(){return a(this,null,function*(){if(!this.isTracking){this.isTracking=!0;try{yield this.retryWithBackoff(()=>a(this,null,function*(){let e=new URL(this.endpoint);e.searchParams.append("domain",this.domain),e.searchParams.append("path",window.location.pathname);let t=document.referrer;t&&!t.includes(window.location.hostname)&&e.searchParams.append("ref",t);let n=this.getUtmParams();Object.entries(n).forEach(([i,s])=>{e.searchParams.append(`utm_${i}`,s)}),yield this.loadPixel(e.toString())}))}catch(e){console.warn("Failed to track page view after retries:",e)}finally{this.isTracking=!1}}})}retryWithBackoff(e,t=3,n=1e3){return a(this,null,function*(){for(let i=0;i<t;i++)try{yield e();return}catch(s){if(i===t-1)throw s;let m=n*Math.pow(2,i);yield new Promise(d=>setTimeout(d,m))}})}shouldRetry(e){return!!(e instanceof Error&&e.message.includes("Network error"))}trackView(){return a(this,null,function*(){try{yield this.retryWithBackoff(()=>this.trackPageView())}catch(e){console.warn("Manual page view tracking failed after retries:",e)}})}},p=new l;typeof window!="undefined"&&(window.Analytics=l,window.analytics=p);})();
//# sourceMappingURL=analytics.min.js.map
